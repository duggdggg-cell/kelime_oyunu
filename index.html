<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kelime Oyunu</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
body {
  font-family: 'Roboto', sans-serif;
  background: linear-gradient(to right, #6a11cb, #2575fc);
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  color: #fff;
  flex-direction: column;
}

.ekran {
  display: none;
  text-align: center;
  background: rgba(255,255,255,0.95);
  color: #333;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0px 4px 20px rgba(0,0,0,0.3);
  width: 400px;
  max-width: 90%;
  animation: fadeIn 0.5s ease-in-out;
}

.aktif { display: block; }

input, button {
  padding: 12px;
  margin: 10px 0;
  width: 80%;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
  transition: all 0.3s ease;
}

button {
  background: #2575fc;
  color: white;
  cursor: pointer;
  font-weight: bold;
}

button:hover { background: #6a11cb; transform: scale(1.05); }

#rol { font-size: 24px; font-weight: bold; margin-top: 20px; }
#kelime { font-size: 28px; color: green; margin-top: 15px; font-weight: bold; }
#oyuncular, #oySonucu { margin-top: 20px; padding: 0; list-style: none; display: flex; flex-wrap: wrap; justify-content: center; }
#oyuncular li, #oySonucu li { background: #2575fc; color: white; padding: 8px 12px; margin: 5px; border-radius: 12px; font-weight: 500; transition: transform 0.3s; cursor: pointer; }
#oyuncular li:hover, #oySonucu li:hover { transform: scale(1.1); }

/* Oyunu Başlat butonu beyaz alanın altında ve ortalanmış */
#baslatBtn {
  display: none;
  padding: 12px 20px;
  font-weight: bold;
  background: #2575fc;
  color: white;
  border-radius: 8px;
  border: 1px solid #ccc;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 120px; /* Daha kısa genişlik */
  margin-top: 15px;
  align-self: center;
}

#baslatBtn:hover { background: #6a11cb; transform: scale(1.05); }

@keyframes fadeIn { 0% {opacity: 0; transform: translateY(-20px);} 100% {opacity: 1; transform: translateY(0);} }
</style>
</head>
<body>

<div class="ekran" id="girisEkran">
  <h2>Odaya Katıl</h2>
  <input type="text" id="isim" placeholder="İsminizi girin">
  <input type="text" id="odaKodu" placeholder="Oda kodu">
  <button onclick="odaKatıl()">Katıl</button>
</div>

<div class="ekran" id="oyunEkran">
  <h3 id="rol"></h3>
  <div id="kelime"></div>
  <ul id="oyuncular"></ul>
  <ul id="oySonucu"></ul>
  <button id="baslatBtn" onclick="oyunuBaslat()">Oyunu Başlat</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let odaKodu = "";
let secilenOyHedef = null;

function odaKatıl() {
  const isim = document.getElementById("isim").value;
  odaKodu = document.getElementById("odaKodu").value;
  if (!isim || !odaKodu) return alert("Lütfen isim ve oda kodu girin!");
  socket.emit("odaKatıl", { odaKodu, isim });
  document.getElementById("girisEkran").style.display = "none";
  document.getElementById("oyunEkran").style.display = "block";
  document.getElementById("baslatBtn").style.display = "block";
}

function oyunuBaslat() {
  socket.emit("oyunuBaslat", odaKodu);
}

socket.on("rol", ({ rol, kelime }) => {
  document.getElementById("rol").textContent = rol;
  if (rol === "OYUNCU") {
    document.getElementById("kelime").textContent = kelime;
  } else {
    document.getElementById("kelime").textContent = "IMPOSTER";
  }
});

socket.on("oyuncuGuncelle", (oyuncular) => {
  const ul = document.getElementById("oyuncular");
  ul.innerHTML = "";
  oyuncular.forEach(o => {
    const li = document.createElement("li");
    li.textContent = o.isim;
    li.dataset.id = o.id;
    ul.appendChild(li);
  });
});

function oyVer(id) {
  if (!secilenOyHedef) {
    secilenOyHedef = id;
    document.querySelectorAll("#oySonucu li").forEach(li => {
      li.style.color = li.dataset.id === id ? "blue" : "#333";
    });
    socket.emit("oyVer", { odaKodu, hedefId: id });
  }
}

socket.on("oySonucu", ({ oySonuclari }) => {
  const ul = document.getElementById("oySonucu");
  ul.innerHTML = "";
  oySonuclari.forEach(o => {
    const li = document.createElement("li");
    li.textContent = `${o.isim}: ${o.oy} oy`;
    li.dataset.id = o.id;
    li.onclick = () => oyVer(o.id);
    ul.appendChild(li);
  });
});
</script>
</body>
</html>
